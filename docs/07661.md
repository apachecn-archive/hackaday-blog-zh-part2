# 更好的 SPI 总线设计

> 原文:[https://hackaday.com/2014/11/25/better-spi-bus-design/](https://hackaday.com/2014/11/25/better-spi-bus-design/)

问一下，如何在微控制器和外设之间连接 SPI 总线？SCK 去 SCK，味噌去味噌，MOSI 去 MOSI，对吗？是啊。你需要加入一个芯片选择引脚，但也差不多了。只有电线，它很可能会工作。现在添加第二台设备。在成千上万的 Arduino 教程中找到的天真的解决方案做同样的事情；只有电线，它可能会工作。事情没那么简单，Teensy 先生本人，[Paul Stoffregen] [在这里向你展示为什么](http://www.dorkbotpdx.org/blog/paul/better_spi_bus_design_in_3_steps)。

使用多个 SPI 器件时，片选线上的上拉电阻是一个非常好的主意。如果没有上拉，设备单独使用时会工作得很好，但一起使用时会莫名其妙地失败。这不是魔法。两台设备都在监听总线，而实际上只有一台设备应该监听总线。将上拉电阻置于 CS 线上可以使一切保持在正确的逻辑电平，直到实际需要某个器件。

味噌线怎么样？当片选信号有效时，大多数外设会断开其引脚，但也有例外。祝你好运找到他们。不过，有一种简单的检查方法:只需连接两个电阻，以便当 CS 引脚为高电平时，MISO 线浮置到非逻辑电平，然后用电压表检查。如果 MISO 被驱动为高电平或低电平，应该在其中放置一个小型三态缓冲器。

这只是硬件方面的情况，使用多个 SPI 器件时，您可以通过软件做一些事情来减少冲突。其中一种方法是处理，或定义时钟速率，设置 MSB 或 LSB 优先，以及时钟的极性。较新版本的 Arduino SPI 库支持事务，设置非常简单。事实上，Arduino 库[中的事务支持是【Paul】自己开发的](http://hackaday.com/2014/08/01/arduino-spi-library-gains-transaction-support/)，它解决了 SPI 相关代码在程序主循环和中断发生时都会出现的问题。了不起的工作，也是全世界 Arduino 制造商的福音。