# 逻辑噪声:与指数 VCO 合拍

> 原文:[https://hack aday . com/2015/09/11/logic-noise-play-in-tune-with-a-index-VCO/](https://hackaday.com/2015/09/11/logic-noise-playing-in-tune-with-an-exponential-vco/)

上节课，我们用廉价欢快的 [4046 锁相环芯片作为简单的压控振荡器](http://hackaday.com/2015/08/07/logic-noise-4046-voltage-controlled-oscillator-part-one/)。事实上，这非常简单，因为芯片已经内置了一个 VCO。4046 的 VCO 有一个很大的缺点:螺距随控制电压线性变化。理想情况下，正如我们将在下一节中讨论的，我们希望频率是控制电压(CV)的指数函数，这意味着需要一点模拟电路。

[René Schmitz 有一个奇妙的指数 VCO 设计](http://www.schmitzbits.de/vco4069.html),几乎完全适合逻辑噪声系列——它用最少的部件构建，边缘有点粗糙，其核心是一个通常用于数字逻辑应用的 4000 系列 CMOS 芯片。从我们的角度来看，唯一的缺点是它使用双电源(正极和负极)。我们将绕过它，以做一些真正快速和肮脏的事情为名，忽略一些 René的其他有价值的改进。我们会用 70%的工作获得 95%的结果，尽管如果你喜欢的话，很容易添加其余的。

[https://www.youtube.com/embed/vT3LK7ZyLDY?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/vT3LK7ZyLDY?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)T2】

让我们从一点规模理论开始。

## 为什么是指数电压控制？

我们人类听到的音高是指数级的。我们习惯的所有[音乐音程](https://en.wikipedia.org/wiki/Mathematics_of_musical_scales)都是基于基频的乘法和除法。例如，我们认为音阶每重复一个八度，此时音高已经加倍。相反，如果你将基本音高乘以 3/2，你就会得到一个“完美的五度”，之所以这么说是因为它是基于初始音高的八音符大调音阶的五度。要制作一个(完美的)大和弦，您需要将根音与五度音和三度音结合，其频率是根音频率的 5/4 倍。它听起来“合拍”，因为组成声音的不同谐波排成一行。

作为一个具体的例子，想象你正在以 440 赫兹演奏一场音乐会“A”。您可以通过弹奏 880 Hz 向上弹奏一个八度，或通过弹奏 220 Hz 向下弹奏一个八度。第五个向上音是 440 * 3/2 = 660 Hz 的“E”。第三个频率为 440 * 5/4 = 550 Hz。所有这些都是说音乐音程都是关于频率的比率。

然而，在电气方面，加和减电压比精确地乘电压要容易得多。例如，我们在我们的[有源混频器电路](http://hackaday.com/2015/07/02/logic-noise-ping-pong-stereo-mixers-and-more/)中看到了这一点。如果简单地将两个信号通过等值电阻输入到带反馈的放大器的输入端，就可以得到两个输入电压之和。倍增电压需要更复杂的放大器设置。乘法频率和加性电压之间的这种不匹配使得线性电压/赫兹比例难以调整。但是还有第二个问题更糟糕。

在我们的例子中，如果你想从“A”到“C”，你必须提高音高 440/4 = 110 赫兹。你可以算出相应的电压增量，一切就绪。然而，如果开始时低一个八度，频率为 220 Hz，那么通过加上 220/4 = 55 Hz，可以得到一个“C ”,因此只需加上前一个电压的一半。线性电压缩放的主要问题是这种加倍和减半。当你在键盘上上下弹奏时，任何给定音程所需的电压增量要么很小，要么很大。复制一架钢琴的音域，在底端用 10 mV 表示一个半音，这是你至少可以做到的，这意味着在顶端的一个半音需要 1.6 V，总音域不到 27 V。这是你基本的[米饭和棋盘问题](https://en.wikipedia.org/wiki/Wheat_and_chessboard_problem)。

我们让 VCO 在内部取幂，这样我们就可以用良好的线性电压从外部控制 VCO。遵循 synth 世界中事实上的标准，我们将设置振荡器，使输入增加一伏将使输出的音高加倍，提高一个八度。如果你想弹奏五度音，不管你在音阶的哪个位置，你都要加上半伏。如果你想要一个[均衡的音阶](https://en.wikipedia.org/wiki/Equal_temperament)，你只需要计算到十二分之一伏特，无论你在键盘的哪个位置，电压增量都是一样的。

简而言之，指数电压频率缩放使得对应音乐音程的电子设备变得更加容易。所以让我们开始吧。

## Expo 转换器

VCO 中的指数转换器利用了这样一个事实，即响应输入电压，让指数电流流过晶体管非常容易。一旦有了指数级的电流流动，剩下的工作就是构建一个振荡器，其频率由电流控制。总之，计划就是这样。

[https://www.youtube.com/embed/GMN94UfnGEo?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/GMN94UfnGEo?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)T2】

每个人都知道并且喜欢(可能)的双极晶体管的基本模型是 [Ebers-Moll 方程](https://en.wikipedia.org/wiki/Bipolar_junction_transistor#Ebers.E2.80.93Moll_model):

![I_E = I_{ES}\left(e^{\frac{V_{BE}}{V_T}}-1\right)](../Images/3d00274a28dde94e0c56cd60f9a0d4ed.png)

其中 I [ES] 是一个常数，取决于特定的晶体管和温度，V [BE] 是施加在基极和发射极上的电压，V [T] 是另一个常数，取决于温度。现在，把这些常数看作是不变的，但是不要忘了我们刚刚说了两次“温度”这个词。

这是一个指数型电压电流转换器:它只是一个晶体管。这是示波器上的电压响应，输入电压跨 x 轴，电流通过电阻并测量压降来测量。(随着流过电阻的电流越来越多，电阻上的压降越来越大，导致测量点的电压成比例降低。)

[![transistor_scaling](../Images/d9878ecddf02381f50a969be9569a36d.png)T2】](https://hackaday.com/wp-content/uploads/2015/08/transistor_scaling.png)

正如你所看到的，电流不可能永远呈指数增长，而是在输入电压达到约 525 mV 时，一旦几乎进入接地电源，电流就会停止。直到基极-发射极电压上升到 400 mV 左右，晶体管才开始导通。但在这两个书立之间，电流确实会随着输入电压呈指数增长。因此，下一步是降低输入控制电压，使其保持在 Ebers-Moll 方程适用的有效范围内。

如果我们有一个 5 V 的控制电压范围，我们希望它在(大约)400 mV 和 525 mV 之间，如果除以 25，则整个范围都合适，因此我们至少需要除以 25。要得到每八度一伏的标度，我们必须做一些数学计算。如果我们将初始电压加上![\Delta V_{BE}](../Images/6c4638d00ec23cb3554c415db70a177d.png)使频率加倍，并取两端的对数，我们得到

![\log(2) = \Delta V_{BE} / V_T](../Images/55822622474b1e9d0ccc62fd09b43a5c.png)

[![scaling.sch](../Images/5f44e143a66e8151a6cb85706922a56f.png) ](https://hackaday.com/wp-content/uploads/2015/08/scaling-sch.png) V

从表面上看，我们还需要至少 400 mV 的电压失调。我们只需添加一个与供电轨相连的分压器和一个电阻，通过另一个电阻将其与控制电压相结合。将所有这些放在一起，我们得到这个缩放电路。

### 温度依赖性

当你建立这个电路时，用你的手指触摸晶体管。你会注意到上面提到的“常数”对温度依赖性的影响。这实际上相当引人注目，消除 I [ES] 引起的大部分温度漂移易如反掌，我们现在就开始吧。

[![](../Images/c9b5c1f2afd300361de6278ce4486980.png)T2】](https://hackaday.com/wp-content/uploads/2015/09/two_transistors_expo-sch.png)

第一个晶体管为 PNP 型，设置为[共集电极电压跟随器](https://en.wikipedia.org/wiki/Common_collector)。这一级的电流增益公式与 NPN 晶体管相同，但电压前面有一个负号，因为 PNP 晶体管中的电流会随着基极电压的增加而关闭。由于这个负号，当求解总电流函数时，两个 I [ES] 因子大致抵消，从而消除了温度依赖性的主要来源。

如果你觉得特别挑剔，你可以用胶带或胶水将两个晶体管粘在一起，这样它们的温度就相同，有助于抵消温度系数。即使你这样做了，你也会发现电路在打开后会漂移一会儿，所以给它一分钟预热时间。

请注意，在 René的设计中，他还在 CV 输入路径中加入了一些热敏电阻(温度相关电阻)。这些抵消了 V [T] 项对温度的(二阶)依赖性，使振荡器对温度的依赖性更小。如果你手头有 10K NTC 热敏电阻，一定要使用它们。否则，不要担心细节——电路已经非常精确。

### 单边供应忽悠

嘿，D1 和 D2 这两个二极管是怎么回事？

[![4069vco1](../Images/574727639dd2b40fa93eb7439832dbae.png)](https://hackaday.com/wp-content/uploads/2015/08/4069vco1.png) 在 René的设计中，PNP 晶体管和失调分压器连接到负电压源，而 NPN 晶体管和输入调整电位计连接到中轨地。由于我们没有真正的中轨地电压，我们将不得不伪造一个。由于我们可能没有那么大的电压裕量，例如电路使用 4xAA 电池，我们将这个假中间轨设置为仅比我们的接地参考稍高一点的电压。

双电源和单路电源的诀窍在于所有电压都是相对的。如果我们称一个电压为“地”或 0 V，那么所有其它电压都是相对于那个电压来测量的。我们将获得最大的负电压(我们的“地”)，并在 René电路中看到负电压时用它来代替。当我们在 René的电路中看到“接地”时，我们需要将电压提高一点。

我们用二极管快速而肮脏地做到了这一点。二极管导通时的压降约为 0.6 V，因此我们将在接地端(电路中最负的电压)与定标电位计和 NPN 晶体管 Q1 的集电极之间放置一个朝下的二极管。比例壶本身没问题，但由于二极管只有在电流流过时才会可靠地降低 0.6 V，我们需要在 NPN 晶体管上偏置二极管，通过在 VCC 上增加一个电阻，使其始终导通。现在，PNP 晶体管的“接地”电平低于 NPN 晶体管，我们在较低的电压下获得了更好的指数缩放。您仍然会注意到，它在最低范围内并不完美，但总比没有好。

## 电流控制振荡器

我们现在已经有了一个晶体管电路，它能产生与合理的 CV 范围成指数关系的电流量。我们所要做的就是建立一个振荡器来配合它。René使用的振荡器设计在理论上比我们通常的 40106 振荡器稍微复杂一点，但它坚如磐石，正是我们需要的。我们会直接复制它。

振荡器的概述是电容器 C1 在其逆变器部分充电和放电。电容器的左侧几乎立即通过二极管 D1 充电，但只能通过指数晶体管缓慢放电，这就是振荡器的音高。振荡器大致有这两种状态:通过晶体管缓慢地将电容器放电，然后再次超快速地将电容器充电。其余的电路只是支持快速充电。

![oscillator_alone.sch](../Images/b8025db8c66d70f3f477fc99c5517c87.png)

电路右侧反馈连接的一对反相器(U1F 和 U1E)形成一个[施密特触发器](https://en.wikipedia.org/wiki/Schmitt_trigger)。

它是这样工作的。如果第一个反相器的输入为高，其输出为低，这意味着下一个反相器的输入为低，其输出为高。作为一对，两个反相器组成一个非反相器。第一个反相器的高输入状态通过 22K 电阻得到加强。

当一种低电平输入通过 10K 电阻时，它将被流过反馈环路的电流部分抵消。只有当输入足够低以克服这种反馈时，第一个反相器才会翻转，触发电路的输入和输出翻转到低状态。该电路中的施密特触发器只是提供一个电流源，用于快速给电容的左侧充电，同时不受电路中少量噪声的影响。一旦电容器充电完成，施密特触发器的输出被二极管 D1 有效地从电路中阻断。

与电容(D2 和 R1)串联的二极管和电阻实际上可以省去，没有太大变化。电阻器的存在仅仅是为了给电容器提供电流路径，通过该电流路径向指数幂放电。当逆变器将其输出切换为高电平时，用一根简单的导线代替电阻会在电容的左侧产生一个小的电压尖峰。该电阻减缓了电容右侧的充电速度，足以抑制该尖峰。

另一方面，我们不想减慢电容右侧的放电速度，因为这会减慢锯齿波的下降速度。当逆变器将其输出切换为低电平时，二极管 D2 为电容器的快速放电提供了一条路径。

同样，缓冲电阻和二极管是一种改进，但它们一起加速斜坡波形的下降部分。这一点很重要，因为电容器放电所需的时间不会随音高而变化，这会妨碍音高从一个八度音程到另一个八度音程的完美跟踪。建成后，你可以期待四到五个八度音程保持合拍。如果没有电阻和二极管，你可以得到大约三个八度音程。无论哪种方式都没有什么大不了的，但这是一个很好的接触，只在设计中增加了两个一美分的部分。

最后，请注意，4069UB 上仍有三个反相放大器可供使用。一种选择是简单地将锯齿波输出馈入反相器，享受快速和肮脏的过驱效应。当然，你可以全力以赴，实现一个过驱动到模糊的电路，这将给你更多的音调变化。

René的建议是使用剩余的三个反相器来创建一个脉冲波形，增加另一个输入，以便您可以调制脉冲宽度。这听起来不错，但是增加了构建的复杂性。稍后，我们将研究各种波形失真器电路，构建斜坡到脉冲电路是一个很好的独立选项，因此，如果您看到这部分电路再次出现在本文中，请不要感到惊讶。

## 调谐

拥有一个每八度一伏的振荡器最大的好处是，现在你可以合拍演奏了。或者至少，一旦你调整好了，你就能做到。幸运的是，这种设计只有两个旋钮，你可以通过调节来调整它。不幸的是，缩放旋钮是可笑的关键和敏感的，需要一点实践来获得正确的。

[https://www.youtube.com/embed/iwj6ZoTCjQU?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/iwj6ZoTCjQU?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)T2】

如果你有某种频率计数器，或者你的示波器像我一样读出显示波形的频率，那么一切都很简单。在 CV 输入上拨入 1 伏，并记录频率。然后拨入两伏。第二个频率是第一个的两倍吗？你完了。太高了吗？向一个方向转动比例旋钮。太低了？把它转到另一边。如果你没有频率计数器，你将不得不用你的耳朵，这是一个更大的挑战。为了帮助解决这个问题，建立这个简单的电路。

[![octaver.sch](../Images/8a872ea72e7d255e3298f64e8a53ab13.png)](https://hackaday.com/wp-content/uploads/2015/08/octaver-sch.png) 它的作用是通过 4051 多路复用器切换三个电压(由三个电位计决定)，多路复用器的输出由晶体管缓冲。如果你一直跟着做，你会从第[第二](http://hackaday.com/2015/02/17/logic-noise-8-bits-of-glorious-sounds/)和第[第三](http://hackaday.com/2015/02/23/logic-noise-the-switching-sequencer/)阶段中得到你需要的所有零件。将电压表插入输出端，设置每个电位计，直到电压读数(例如)正好为 1 伏、2 伏和 3 伏。最简单的方法是断开时钟发生器，简单地把信号接到 VCC 和 GND，直到你需要设置的电位计被选中。一切就绪后，重新连接时钟。

现在你有了一个可以上下弹奏三个八度音的电路。如果你知道你在听什么，用你的耳朵就能很容易地把它调整到合适的音调。或者，如介绍视频所示，您可以用任何您想要用来播放 VCO 的东西来现场调整电路。我的键盘输出稳定的 1V/倍频程，但如果你的没有，你需要调整 VCO 来匹配。好的一面是你有灵活性。

现在八度音阶开始工作了，您可以用 CV 偏移电位计调谐振荡器以匹配另一种乐器。这个简单多了，你可以用耳朵来做。之后你不需要重新做八度音阶，但是在你拿着这个上台之前再检查一遍也无妨。最坏的情况是，在一切都完美之前，您可能需要在缩放和偏移调整之间来回切换几次。这是你想要合拍所付出的代价。

## 下一步是什么？

现在我们有了一个调谐的每倍频程电压 VCO。你的作业是把这些电路中的一个连接到试验板上，然后摆弄它。看看你周围有什么样的电压源，把它们连接起来。试试把一串电阻排成一行，像多级分压器一样，从 VCC 连到 GND。你可能想用一个晶体管电路缓冲它们，但是你应该能够像弹奏键盘一样弹奏它们。

一旦你确信你喜欢这个电路，把它放在 perfboard 或类似的东西上的焊料和电线中。它可能比在试验板上表现得更好，因为该电路处理小电压差和低信号电压。无论如何，这是一个很好的模块。如果你没有玩过模块化合成器，这是一个伟大的“真正”的第一步。如果你有，你就已经知道声音(或者扩音器)不能太多。

下节课，我们将看看电压控制可以做什么。具体来说，我们将构建一个数模转换器(DAC ),并开始演奏调音音阶，然后在混音中添加一个移位寄存器，以产生远远超过其各部分之和的效果。

如果您一直在跟进，您可能会感到困惑，因为我上次说过，我会将 4046 PLL 振荡器改造为每倍频程 1 伏，然后我们切换到一种完全不同的架构。怎么回事？电路故障。在这个会议的振荡器有两个旋钮，这是必要的调整，4046 指数转换器有三个，这只是一个混乱的事情得到调整。但不要担心，在我们花了几个会议玩我们全新的 VCO 玩具后，我们会再次看到 4046 PLL。