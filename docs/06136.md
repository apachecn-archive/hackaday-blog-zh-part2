# Arduino 车库门开门器具有安全意识

> 原文：<https://hackaday.com/2014/05/25/arduino-garage-door-opener-is-security-minded/>

自己动手车库开门器现在一定很流行。我们刚刚听说这个流行的想法又有了新的进展。[Giles]受朋友的委托，寻找一种用智能手机控制朋友车库门的方法。这个要求是可以理解的，考虑到昂贵的车库门遥控器，以及昂贵遥控器上的按钮过一会儿就会失灵的事实。这个项目的灵感来自于其他类似项目的一些 YouTube 视频。这些项目都将 Arduino 与蓝牙耳机配对，以便通过手机控制门。[Giles]明白虽然这样可以完成工作，但不太安全。蓝牙耳机通常使用四位 PIN 码连接到移动电话。他们中的许多人都知道默认 PIN，即使默认 PIN 被更改，也不需要很长时间就能猜出一个四位数的 PIN。[贾尔斯]知道他必须找到一个更安全的方法。

虽然 WiFi 是一种选择，但[Giles]认为将车库门连接到互联网可能会有安全风险，即使它确实提供了一些潜在的有趣的使用案例。因此，他选择坚持使用蓝牙，但决定使用 Seedstudio 蓝牙盾，而不是基本的耳机。电子设备相对简单。[Giles]只需将蓝牙屏蔽插入 Arduino Uno。[Giles]蓝牙屏蔽确实有一个问题。蓝牙模块不接受许多标准 AT 命令。他需要一种方法，在移动设备身份验证失败时，强制断开移动设备。在四处挖掘之后，他发现该模块有一些额外的裸露焊盘，他可能会使用这些焊盘来实现这个目标。唯一的问题是他们期待的是 3.3V 信号，而 Arduino 的工作电压是 5V。解决办法很简单。他用两个电阻建立了一个基本的分压器。这将来自 Arduino 的 5V 信号降低到了所需的 3.3V。这为移动电话提供了通信功能。然后他意识到他可以用一个简单的 12V 汽车继电器来控制车库门。为了控制继电器，他使用了 Freetronics 继电器控制罩。最终结果是一堆相对简单的屏蔽连接到一个继电器上。

对于智能手机界面，[Giles]开始尝试编写一个原生 Android 应用程序。由于在 Android 开发方面没有什么经验，他很快意识到，以这种方式获得任何可用的东西将花费他比预期更长的时间。然后他决定用 [SL4A](http://en.wikipedia.org/wiki/Scripting_Layer_for_Android "Scripting language for android") 。SL4A 为 Android 提供了一个脚本环境，支持几种不同的脚本语言。[Giles]然后能够编写一个可以在智能手机上执行的 Python 脚本。许多人可能会想写一个非常简单的脚本，只打开门并连接，而没有真正考虑安全性。毕竟，这是一个一次性的不起眼的车库开门器。默默无闻的安全感！[贾尔斯]比那更聪明。

相反，他在 Python 脚本和 Arduino 之间实现了挑战握手认证机制。这将确保在允许执行命令之前对用户进行身份验证，还有助于防止重放攻击。这个过程是这样的。首先，智能手机连接到 Arduino。然后，Arduino 会生成一个伪随机字符串，并根据预共享密钥计算预期的响应。然后，手机接收字符串并发回适当的响应。如果不匹配，Arduino 会断开电话。如果匹配，则电话发送回对不同伪随机命令挑战串的请求。一旦电话接收到这个新的字符串，它就能够结合第二个预共享密钥使用该字符串来生成一次性使用命令。假设计算正确，Arduino 将运行命令打开或关闭门。如果不匹配，电话就会断线。所有这些都是为了帮助防止重放攻击。任何观看无线电波的攻击者都不能简单地记录信号或命令并回放它们。这是因为每次传输认证和命令时，基于伪随机种子，它们必须是不同的。

虽然一切似乎都很好，但 Arduino 往往会在大约六个门周期后崩溃。[Giles]认为这可能是由他使用的 MD5 库引起的，但是到目前为止还没有成功修复这个错误。他还认为他的 Python 脚本很乱，有些不稳定。他决定将他的程序发布到互联网上，希望其他人有时间和动力来弄清楚发生了什么。