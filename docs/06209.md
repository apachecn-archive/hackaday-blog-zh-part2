# 嗡嗡作响:选择飞行控制器

> 原文:[https://hack aday . com/2014/06/06/droning-on-flight-controller-round-up/](https://hackaday.com/2014/06/06/droning-on-flight-controller-round-up/)

![do4](../Images/fefa5419d0e10e50431ac9c7dfe8a6ba.png)飞行控制器是无人机的神经中枢。无人机飞行控制系统多种多样。从通过双向遥测链路飞行的 GPS 自动驾驶系统到使用业余爱好级无线电控制硬件的基本稳定系统，有一个开源项目适合您。

现代无人机飞行控制器可以追溯到遥控直升机。历史上，遥控飞机是由飞行员的无线电直接控制的。直升机增加了一个新的难题:尾桨。直升机使用其尾部(或反扭矩)旋翼来抵消试图旋转整个直升机机身的主旋翼的扭矩。当直升机悬停时，这一切都很好，但当飞行员加大油门准备飞出时呢？随着飞行员加大油门，扭矩增加，这导致整个直升机做一个或两个自旋，直到扭矩再次变平。这种影响已经导致不止一名初级飞行员与他们的遥控直升机面对面。

这个问题的解决方案是陀螺仪，沉重的黄铜旋转重物，随着直升机的运动而倾斜。霍尔效应传感器将检测到倾斜，并命令尾桨抵消直升机的旋转。随着时间的推移，固态 MEMS 陀螺仪取代了机械陀螺仪。微控制器出现了，并带来了先进的处理技术。然后引入了航向保持陀螺仪。老式的“速率型”陀螺仪会漂移、随风向改变方向和摆动，而航向保持陀螺仪会锁定直升机的机头，直到飞行员命令转弯。这些单轴飞行控制器很快被遥控直升机团体所采用。

今天的飞行控制系统有许多传感器可供使用——全球定位系统、气压传感器、空速传感器，不胜枚举。飞行计算的主要贡献者仍然是陀螺仪和加速度计。顾名思义，加速度计测量加速度——无论是重力加速度、高 G 转弯加速度还是制动力加速度。然而，加速度计是不够的——自由落体中的加速度计将测量 0 G。转向力会使试图仅根据加速度计数据操作的系统混乱。这就是陀螺仪的用武之地。陀螺仪测量绕轴旋转的速度。正如我们上面的直升机例子包括偏航，陀螺仪可以用来测量飞机的俯仰和滚转。InvenSense 的[视频对陀螺仪和加速度计进行了对比。](https://www.youtube.com/watch?v=s19W-MG-whE)

休息之后，请和我们一起参观可用的飞行控制器，以及每一种控制器都增加了什么。 [![1024px-Flight_dynamics_with_text](../Images/cc88798652ac4f9115060dc0b3e30e10.png)惯性测量单元](http://en.wikipedia.org/wiki/Inertial_measurement_unit)是读取这些传感器并执行[传感器融合](http://en.wikipedia.org/wiki/Sensor_fusion)算法以确定当前位置和姿态的设备。今天生产的几乎每架全尺寸飞机内部都有某种形式的 IMU。甚至你的智能手机也可以充当 IMU。给 IMU 控制平台的能力，你就有了一个飞行控制器。那么，飞行控制器如何从陀螺仪、加速度计和其他传感器获取数据，并将其转换为稳定的飞行平台呢？答案就在一些巧妙的数学和软件中。大多数飞行控制器的核心是一种叫做[比例积分微分](http://en.wikipedia.org/wiki/PID_controller) (PID)控制回路的软件算法。PID 回路和它们的调整是如此重要的一个话题，我将奉献一整个专栏来讨论它，所以如果你在使你的飞机稳定方面有困难，请耐心等待，帮助已经在路上了！**选择飞行控制器**现在有很多流行的飞行控制器在使用。决定哪一个适合您的需求可能是一个艰难的选择。我们在这里讨论了开源飞行控制器，但是如果我没有提到商业产品，那我就太粗心了。DJI Naza 控制器是市场上最优秀的商业控制系统。许多专业和业余飞行员每天都使用这个系统。Naza 通过一个简单的界面提供基本的飞行控制、姿态保持和返航功能。不过，娜扎并不完美。一个问题是基于 GPS 的飞行拒绝——DJI 自动驾驶系统将不允许飞机飞越中国的紫禁城。毫无疑问，这是由于中国政府的要求。然而，该系统的闭源性质使人想知道代码中可能隐藏着什么其他“特性”。飞行控制系统中的“四巨头”似乎是 KKmulticopter、Multiwiicopter、Pixhawk 和 OpenPilot。![54299s7(1)](../Images/27d0eceea3753d323173205fdf9bf182.png)

#### **KK 多翼机**

KK 板是由 Rolf R. Bakke，又名 KapteinKuk 设计的。KK 板最受欢迎的形式似乎是霍比金 KK 多翼机板，目前的版本是 2.1.5，如果你能在库存中找到的话。KK2.1 板基于 Atmel ATmega644PA 处理器和 InvenSense MPU-6050。6050 是一款有趣的芯片，它不仅包括 3 个陀螺仪和 3 个加速度计，还包括一个专用于处理传感器输出的微控制器。这减轻了 Atmel 芯片的一些负担。对于 8 位微处理器来说，还有相当多的工作要做，Rolf 通过用汇编代码编写整个固件来加速这个过程。这里的双刃剑是汇编代码限制了项目中开发人员的数量。KK 板的接口很简单。一个小的图形 LCD 和 4 个按钮允许用户编程参数。KK 的飞行控制算法只用 P 和 I，KK 板上没有 D。KK 董事会似乎没有官方网站，但信息(和最新来源)可以在 [RCgroups megathread 上找到。](http://www.rcgroups.com/forums/showthread.php?t=1675613)KK 董事会可以被认为是一种入门药物。它成本低，易于安装，而且能完成工作。你不需要一台电脑来设置它，一切都在板上安装的液晶显示器。对于任何常见的无人机类型来说，KK 板都不是一个出色的表现者，但如果你只是想出去玩一趟，享受一次愉快的飞行，它就足够好了。![mwc](../Images/d5531145011c670e57eecb9647faaae1.png)

#### **用于**的多视图

接下来是 [MultiWii](http://www.multiwii.com/) 。MultiWii 的名字来源于它最初的传感器。MultiWii 的第一个版本被设计成使用任天堂 Wii Nunchuck 陀螺仪和加速度计，因为它们很便宜，在世界各地都很容易买到。从那以后，事情发生了很大的变化。当前的 MultiWii 板 MultiWii Pro (MWP)进行了一系列传感器升级。MWP 板基于 Arduino，采用 ATmega2560 处理器。软件是用 Arduino 的本地布线语言编写的，使用每个人都喜欢的基于 IDE 的处理。该板目前的传感器套件非常广泛。除了通常的陀螺仪和加速度计，它还有一个气压计、磁力计(指南针)和一个可选的 GPS。MultiWii 还允许许多配置方法。场外液晶显示器和有机发光二极管显示器可以连接现场配置。完整的 GUI 配置程序可通过板载 USB 端口或蓝牙子板获得。MultiWii 的源代码托管在他们的[谷歌代码页](https://code.google.com/p/multiwii/)上，尽管有一个 [Github 镜像](https://github.com/multiwii/multiwii-firmware)供你 git 粉丝使用。MultiWii 能够稳定遥控飞机、直升机或多翼飞机。董事会正处于完全自动驾驶的风口浪尖。它不像 APM 那样光滑，部分原因是没有一个资金充足的公司实体来推动这个或那个方向的发展。虽然核心开发人员很活跃，但这是一个很好的看板。![APM2](../Images/ac83661f2e3b5cc86a0f1bd4042f2048.png)

#### **Mega 2 (APM2)**

APM 是 3DRobotics 的一个开源项目。它的前身是 Ardupilot，一种基于 Arduino 的固定翼飞行控制系统。该项目很快发展到包括漫游者，直升机和多翼机。虽然该项目仍然与 Arduino IDE 兼容，但开发网站提供了在 Windows 上使用 Visual Studio 的教程，以及在 Linux 环境中使用“make”命令。当前的硬件是 APM2.6，它利用 ATmega2560 作为主处理器。ATmega32u4 处理 USB 功能。InvenSense MPU-6000 处理陀螺仪和加速度计任务。APM2 有一个机载气压传感器。提供了非车载 GPS 和磁力计/罗盘模块的接口。APM 和 Pixhawk 使用相似的软件版本，所以查看下面的 Pixhawk 以了解更多信息。![pixhawk](../Images/1f42833c118da9c193be8a9bff65d587.png)

#### **Pixhawk**

APM2 代码库的复杂性增长如此之快，以至于他们的 8 位 ATmega2560 耗尽了内存和处理能力。3DRobotics 显然需要一个有进一步发展空间的新平台。他们选择在 PX4 项目的硬件平台上进行构建。PX4 始于 2009 年，目前在瑞士联邦理工学院进行开发。3DRobotics 将 APM 代码移植到 Px4，并推出了他们自己版本的硬件 Pixhawk。Pixhawk 使用 STM32F427 处理器，这是一个 32 位 ARM Cortex M4 内核，带有板载 FPU。3Drobotics 也使用实时操作系统。 [NuttX](http://nuttx.org/) 是一个免费的开源 RTOS。NuttX 从一开始就是作为 RTOS 设计的，比 Linux 或其他操作系统要轻得多。它可以与 VxWorks 或 RTOS 的其他工业/航空航天产品相媲美。Pixhawk 包括陀螺仪、加速度计、气压计、GPS、磁力计/罗盘和遥测装置。它还有一个用于数据日志的 MicroSD 卡插槽，这可以让在线寻求帮助变得容易得多。PixHawk 和 APM2 都使用基于 GUI 的任务软件进行配置。它们也可以像全自动驾驶仪一样工作，执行基于航路点的任务。在源代码方面，Pixhawk 背后有一个庞大的活跃的开发人员社区。来源可以在 [DIYdrones Github 上找到。](https://github.com/diydrones) 3DRobotics 在这里绝对有特色优势。他们有资源来实现大量的软件特性，构建模型，并完成产品。他们的 [IRIS 无人机](https://store.3drobotics.com/products/IRIS)可能是商业市场上第一架完全自主的无人机。

#### open pilot CC3D/革命

**![openpilot-revolution-kickstarter](../Images/6446c967b89dabb86e0023d2f057192b.png) ** [OpenPilot](http://www.openpilot.org/) 是另一个长时间飞行控制器项目。目前支持两个平台，CopterControl 3D (CC3D)和他们的新旗舰板 Revo。CC3D 使用 STM32F103 Arm Cortex M3，以及一套陀螺仪和加速度计。部分由于当前的迷你 FPV 热潮，CC3D 板仍然很受欢迎。这导致了相当多的衍生板出现，如 Lumenier edition ~~和 Acro Naze32~~ 。在小型 FPV 多翼飞机的“转弯和燃烧”飞行风格中，这些冲浪板似乎非常好。Openpilot 项目正在转移到他们的新板 Revolution 上。Revo 采用 STM 32 f 405 rgt 6 32 位 ARM Cortex M4 处理器。Revo 使用 InvenSense MPU6000 加速度计/陀螺仪芯片，以及气压传感器和磁力计。Revo 还支持遥测和 GPS。CC3D 和 Revo 都使用基于 GUI 的地面控制软件进行配置。源代码可以在 [OpenPilot 的 git 服务器](http://git.openpilot.org/)上获得。OpenPilot 有一些团队更替问题，但他们现在取得了很大进展。Revo 包括一些高级功能，如机载遥测无线电。再加上当前代码库处理小型灵活多翼飞机高速机动的能力，这种板有着光明的前景。

#### 选择控制器时的建议

所有这些飞行控制员都很能干。决定在你的无人机上使用哪一种取决于飞行特性，以及你所寻找的飞行风格。作为开源项目，它们都有衍生板和低成本的克隆版本。当心成本最低的克隆产品。他们中的一些人很棒，但另一些人至少可以说是平庸的。有时节省几美元意味着更低质量的组件和装配。没有什么比看到数百美元和数小时的努力因为一个破裂的焊点或一个坏的电容器而付诸东流更糟糕的了。

#### 黑客日测试平台更新

零件终于来了，构建已经开始！如果你想了解我在 Hackaday 无人机测试平台上的进展，这是一种将用于测试这些飞行控制器的四轴飞行器，请前往 [Hackaday.io 项目页面](http://hackaday.io/project/1362-The-Hackaday-Drone-Testbed)！这一版大概就是这样。直到下一次，继续唠叨！【标题图片由 Joergens.mi/Wikipedia[提供](http://commons.wikimedia.org/wiki/File:Wikicon2013_jm8532.jpg)